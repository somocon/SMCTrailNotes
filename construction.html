<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.556">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Trail Notes - 3&nbsp; Trail construction</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./maintenance.html" rel="next">
<link href="./history.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./construction.html"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Trail construction</span></a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Trail Notes</a> 
        <div class="sidebar-tools-main">
    <a href="https://somocon.org" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-git"></i></a>
    <a href="./Trail-Notes.pdf" title="Download PDF" class="quarto-navigation-tool px-1" aria-label="Download PDF"><i class="bi bi-file-pdf"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">The Trails of the South Mountain Reservation (SMR)</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./history.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">History of the trails</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./construction.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Trail construction</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./maintenance.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Maintenance</span></span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#sustainable-trails" id="toc-sustainable-trails" class="nav-link active" data-scroll-target="#sustainable-trails"><span class="header-section-number">3.1</span> Sustainable trails</a>
  <ul class="collapse">
  <li><a href="#the-half-rule" id="toc-the-half-rule" class="nav-link" data-scroll-target="#the-half-rule"><span class="header-section-number">3.1.1</span> 1. The half rule</a></li>
  <li><a href="#the-ten-percent-average-guideline" id="toc-the-ten-percent-average-guideline" class="nav-link" data-scroll-target="#the-ten-percent-average-guideline"><span class="header-section-number">3.1.2</span> 2. The ten percent average guideline</a></li>
  <li><a href="#maximum-sustainable-grade" id="toc-maximum-sustainable-grade" class="nav-link" data-scroll-target="#maximum-sustainable-grade"><span class="header-section-number">3.1.3</span> 3. Maximum sustainable grade</a></li>
  <li><a href="#grade-reversals" id="toc-grade-reversals" class="nav-link" data-scroll-target="#grade-reversals"><span class="header-section-number">3.1.4</span> 4. Grade reversals</a></li>
  <li><a href="#outslope" id="toc-outslope" class="nav-link" data-scroll-target="#outslope"><span class="header-section-number">3.1.5</span> 5. Outslope</a></li>
  <li><a href="#trail-layout" id="toc-trail-layout" class="nav-link" data-scroll-target="#trail-layout"><span class="header-section-number">3.1.6</span> Trail layout</a></li>
  </ul></li>
  <li><a href="#existing-trail" id="toc-existing-trail" class="nav-link" data-scroll-target="#existing-trail"><span class="header-section-number">3.2</span> Existing trail</a>
  <ul class="collapse">
  <li><a href="#fords" id="toc-fords" class="nav-link" data-scroll-target="#fords"><span class="header-section-number">3.2.1</span> Fords</a></li>
  <li><a href="#water-bars" id="toc-water-bars" class="nav-link" data-scroll-target="#water-bars"><span class="header-section-number">3.2.2</span> Water bars</a></li>
  <li><a href="#swales" id="toc-swales" class="nav-link" data-scroll-target="#swales"><span class="header-section-number">3.2.3</span> Swales</a></li>
  <li><a href="#principles" id="toc-principles" class="nav-link" data-scroll-target="#principles"><span class="header-section-number">3.2.4</span> Principles</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://somocon.org/edit/main/construction.qmd" class="toc-action"><i class="bi bi-git"></i>Edit this page</a></li><li><a href="https://somocon.org/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Trail construction</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<pre class="{julia}"><code>#| echo: false
#| output: false
using PolygonOps
using Roots
using Plots
nothing</code></pre>
<section id="sustainable-trails" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="sustainable-trails"><span class="header-section-number">3.1</span> Sustainable trails</h2>
<p>Since 2007 the South Mountain Conservancy, primarily through the work of its Trail Work Crew, has incorporated several new miles of trails within the 50+ miles of trails. These new trails have been built with sustainability in mind. What makes sustainability an issue is <em>water erosion</em>. A failure to account for water flow can quickly turn a trail in good shape into a disaster.</p>
<p>In the following, we mention a few terms related to trails:</p>
<ul>
<li>hill slope – the slope of the “fall line” at a given point on the hill</li>
<li>trail grade – the slope of the trail in the direction of the trail</li>
<li>outslope – slope of the trail in the direction <em>perpendicular</em> to the trail</li>
</ul>
<p>Water, when unconstrained, should flow in a sheet manner down a hill following the hill slope. When this water hits the trail, it may run along the trail, not down the hill. This can cause erosion of the trail. Accounting for the various slopes is an important part of trail layout.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Water is the enemy of a trail system
</div>
</div>
<div class="callout-body-container callout-body">
<p>Water is the primary enemy of a trail system. Even in its most benign presence, when a trail is muddy, hikers tend to avoid the mud and widen the trail in the process. Even more damaging is when water is concentrated enough and flowing fast enough to cause erosion.</p>
<p>Water can carry sediment. Faster water can carry more sediment. During heavy rain, much of the trail surface can be picked up and moved by fast-flowing water. When water slows, it can not carry the same amount of sediment, and deposition occurs. A single storm can erode a trail section and also quickly fill in areas.</p>
<p>Doing everything possible to ensure flowing water does not run down the length of the trail is the key to having sustainable trails.</p>
</div>
</div>
<p>The five essential elements of <em>sustainable</em> trails<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>:</p>
<section id="the-half-rule" class="level3" data-number="3.1.1">
<h3 data-number="3.1.1" class="anchored" data-anchor-id="the-half-rule"><span class="header-section-number">3.1.1</span> 1. The half rule</h3>
<p>The half rule says the trail grade should not exceed half the hill slope.</p>
<p>For an example, a fall line trail would have slope equal to the hill slope and would exceed the half rule. A contour trail would have zero slope and would satisfy the half rule. Of course, trails must gain and lose elevation, this rule limits how much elevation can be changed given the hill side.</p>
<p>The guidelines note that this is <em>still</em> important when the slopes are gentle.</p>
<p>For very steep hill sides, the slope should still not exceed more than 10-12 degrees, though there are instances where for very short lengths this rule may be ignored.</p>
</section>
<section id="the-ten-percent-average-guideline" class="level3" data-number="3.1.2">
<h3 data-number="3.1.2" class="anchored" data-anchor-id="the-ten-percent-average-guideline"><span class="header-section-number">3.1.2</span> 2. The ten percent average guideline</h3>
<p>The half rule applies for a small section of trail; the ten percent average says the end to end grade should be no more than 10 percent. (1000 feet over 2 miles is an example.)</p>
<p>We have generally been conservative here.</p>
</section>
<section id="maximum-sustainable-grade" class="level3" data-number="3.1.3">
<h3 data-number="3.1.3" class="anchored" data-anchor-id="maximum-sustainable-grade"><span class="header-section-number">3.1.3</span> 3. Maximum sustainable grade</h3>
<p>The maximum grade is the maximum slope of a section of a length more than 10 feet. It is said 15-20 degrees is the maximum. For hiking trails, we’ve aimed for 10 degrees. Factors which can change the maximum slope are: soil type, rock, rainfall, grade reversals, number of users (more users, less slope)</p>
</section>
<section id="grade-reversals" class="level3" data-number="3.1.4">
<h3 data-number="3.1.4" class="anchored" data-anchor-id="grade-reversals"><span class="header-section-number">3.1.4</span> 4. Grade reversals</h3>
<p>A grade reversal means varying the slope of the tread from downhill to uphill. Any water flowing along the trail will fall to the changeover where it can be removed off the trail with a knick (semi-circular shaved down section of trail). Grade reversals are laid out when the new trail is built.</p>
</section>
<section id="outslope" class="level3" data-number="3.1.5">
<h3 data-number="3.1.5" class="anchored" data-anchor-id="outslope"><span class="header-section-number">3.1.5</span> 5. Outslope</h3>
<p>Outslope is recommended to be 5 degrees. This encourages water to flow off the trail.</p>
<p>Of course, one can’t outslope the trail tread <span class="math inline">\(5\)</span> degrees if the hill slope is less than <span class="math inline">\(5\)</span> degrees. It isn’t advised to put trails on flat ground, as it is difficult to manage water flow.</p>
<p>Road construction offers an analogy: a road is crowned online its middle and slopes outward to both edges. This encourages water flow to the edges. At the edges curbing (often Belgian block) is used to constrain the water flow parallel to the road way. If this is not present, erosion at the road edge is common.</p>
<p>The outslope is similar to the crown. Also important is the <strong>avoidance</strong> of mounds on the trail edge that act like curbing. Unlike a road, water flow should flow off the trail and <em>not</em> parallel to the trail. Berms naturally build and may be knocked down by foot.</p>
<pre class="{julia}"><code>#| echo: false
#| fig-caption: Cross section showing outslope of 5 degrees, benchcut of 45 degrees, dirt to be removed and cast aside during construction.
hill_slope = 30*pi/180
outslope = 5 * pi/180
width = 24
x = -width * cos(outslope)
y =  width * sin(outslope)
p = (x=x,y=y)
q = (x=0,y=0)
# solve((x - sqrt(2)/2 * t ~ -sqrt(3)/2*s, y + sqrt(2)/2 * t ~ 1/2*s), (t,s))
r = (x=-51.62, y=29.8)

plot(Plots.Shape([r.x, r.x, q.x], [r.y, q.y, q.y]);
     legend=false, aspect_ratio=:equal,
     axis=([], false),
     fill=(:gray, 0.1), line=(2,))
plot!(Plots.Shape([r.x,p.x, q.x, r.x], [r.y, p.y, q.y, r.y]);
      fill = (:gray, 0.3))
plot!([p.x,q.x],[p.y,q.y], line=(5,), color=:red)
plot!([p.x, p.x, q.x], [r.y, p.y, p.y], line=(1, :gray, :dash))
annotate!([(-15, 1.5*sin(outslope), "5⁰"),
           (-5, 2*5*sin(outslope), "30⁰"),
           (-30, 15, "Benchcut")])</code></pre>
<p>The figure shows a cross section of the trail. The tread is in red. The 5 degree outslope is about 5 inches over 5 feet, which coincides with the width of the head of the <a href="https://en.wikipedia.org/wiki/McLeod_(tool)">McLeod</a> and its handle length. This allows eyeballing the correct slope by placing the head on the tread and ensuring the end of the handle is just about over the edge of the head. Even more informally,5 degrees is just about the angle where one feels pressure on the downhill side of ones shoe when pointing in the direction of the trail.</p>
<section id="benchcut" class="level4">
<h4 class="anchored" data-anchor-id="benchcut">Benchcut</h4>
<p>The figure shows the benchcut needed to make an outslope of 5 degrees when the hill slope exceeds 5 degrees. The dirt should be removed and broadcast widely to hide the activity.</p>
<p>Benchcuts should not be to steep (the one in the figure is 45 degrees).</p>
<p>The interface between the benchcut and the tread should not encourage water flow down the trail – it should be smooth</p>
<p>Take care when roughing out the trail so that the top edge of the benchcut is a smooth line in the direction of the tread. The benchcut will guide walkers to stay on the trail tread during the months when leaves have fallen on the trails.</p>
<hr>
</section>
</section>
<section id="trail-layout" class="level3" data-number="3.1.6">
<h3 data-number="3.1.6" class="anchored" data-anchor-id="trail-layout"><span class="header-section-number">3.1.6</span> Trail layout</h3>
<p>A new trail is first sited roughly using ribbon to mark out the passage. New trails should consider not just water flow, but also purpose. The trail systems is quite mature and new trails are likely not needed anymore. In the event a trail is to be designed, try to incorporate natural features (large rocks, streams, viewpoints, …) in the design. New trails should avoid excessive growth, like grass or ferns which indicate an abundance of water.</p>
<p>When designing the trail path, think about reverse grades.</p>
<p>After roughing out the trail, a clinometer is brought in to assess the angles to ensure the trail does not exceed the slope requirements suggested.</p>
<p>A trail is then flagged with pin flags. We flag the <em>uphill</em> part of the trail, where a bench cut would be set. (The bench cut would connect the flags in a straight segments).</p>
<p>When there is a switch back, two pin flags are used to indicate a switch of uphill side.</p>
<p>The tread width is 18-24”, about shoulder width or a bit wider for single track. Making the trail wider is counterproductive. We want footsteps to compact the trail inhibiting vegetation.</p>
<p>The creation of a trail tread involves several steps:</p>
<ul>
<li>move any leaves <em>uphill</em> of the intended trail. (These will be used at the end to cover off-trail dirt.)</li>
<li>use an adze hoe or McCleod to make the bench cut</li>
<li>remove the wedge of dirt needed. Dirt should be broadcast down hill; not lumped into an unnatural pile</li>
<li>We aim to remove the <em>organic</em> dirt from the tread. Organic dirt holds moisture and leads to mud, not water flow.</li>
<li>Some rocks may stay – if large and anchored; others are dug out. It is not recommended to try and fill holes that are made – it is better to leave large rocks, not large holes.</li>
<li>Small roots should be cut; larger ones left. (Though roots which may encourage water flow along the trail should be removed.)</li>
<li>Once roughed out, use the McCleod to smooth the trail in the direction of the tread.</li>
<li>Ensure the trail has proper outslope and no berm on the downhill side. Do not put rocks or limbs on the downhill side (a path to Grandma’s house), as this inhibits water flow off the trail.</li>
<li>Use the head of the McCleod to tamp down the loose dirt</li>
<li>Use the reserved leaves to cover up any dirt and form the downhill edge of the trail</li>
</ul>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Not what is in the IMBA guide
</div>
</div>
<div class="callout-body-container callout-body">
<p>The IMBA guide suggests this order:</p>
<ul>
<li>dig the tread</li>
<li>cut the backslope (bench cut)</li>
<li>outslope the tread</li>
<li>compact the tread.</li>
</ul>
<p>The order above prioritizes the initial bench cut to give a cleaner edge to the finished trail.</p>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Trail building is slow
</div>
</div>
<div class="callout-body-container callout-body">
<p>Trail building proceeds at a slow and steady pace. Trying to do too much results in poor, unsustainable trails.</p>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Organic soil removal
</div>
</div>
<div class="callout-body-container callout-body">
<p>Trail building for the uninitiated might seem easy, just scrape the grass or leaves away and you have a new trail. However, it is much more involved. Beyond managing the layout and the slopes, another key is the removal of the organic top level of soil. This layer is formed by the decomposition of leaves and in general is a good thing, as vegetation is likely to grow faster and bigger in organic soil.</p>
<p>However for a trail, we want soil that does not retain water, rather sheds it. We want soil that can compact, and inhibit vegetation. The soil under the organic layer in the SMC is usually clay-ey and is desirable. Organic soil is darker and fecund looking; clay is less dark and compact. When removing the organic, we look for a color change. Depending on location, organic soil can be 1/2 inch to several inches deep.</p>
</div>
</div>
</section>
</section>
<section id="existing-trail" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="existing-trail"><span class="header-section-number">3.2</span> Existing trail</h2>
<p>Water management for <em>existing</em> trails is different. In the South Mountain Reservation, much water flow is engineered by the use of swales and culverts to <strong>not</strong> flow as sheets along the surface. For such concentrated flows, simple trail design as above is not enough.</p>
<p>We mention here a few techniques to manage water flow once it has aggregated.</p>
<section id="fords" class="level3" data-number="3.2.1">
<h3 data-number="3.2.1" class="anchored" data-anchor-id="fords"><span class="header-section-number">3.2.1</span> Fords</h3>
<p>Fords are designed to allow water to flow <em>across</em> the trail. This water is already channeled, as can happen through uphill engineering (drainage of culverts for example) or natural water flow.</p>
<p>The design for fords takes <em>two</em> basic shapes: a trench or a smoothed out crossing.</p>
<section id="trenches" class="level4">
<h4 class="anchored" data-anchor-id="trenches">Trenches</h4>
<p>Trenches are commonly reinforced on the edges with rocks, a common design on the trails dating to the CCC days. Most of these are <em>also</em> accompanied by uphill drainage collectors, often in the shape of a “Y” – with two collecting arms and the bottom of the “Y” forming the ford. The collecting arms may also be called drainage swales.</p>
<p>The width of a trench has a few constraints:</p>
<ul>
<li>If a trench is too narrow, leaves will get caught on sides and block water flow</li>
<li>The trench can’t be wider than a single step across for a hiker. This means <em>maybe</em> 18” maximum.</li>
<li>If they are wider than a bicycle wheel can comfortably cross, the bicylists will <em>often</em> put in a rock to cross the ford <strong>thereby defeating the purpose</strong> which is for water to flow through the ford.</li>
</ul>
<p>The depth of the trench and the width determine the cross sectional area which must be large enough to accommodate peak water flow.</p>
<p>The following illustration shows how a wheel of a given radius flows over a ford. In this illustration the ford is kept fixed and the radius varies, unlike in real life where the radius of a wheel may be 29/2 inches.</p>
<pre class="{julia}"><code>#| echo: false
#| eval: false
function f(R=29/100)
    ts = range(-2, 2, 251)
    f(x) = 1 + sum(sinpi(k*x)/k for k in 1:2:17)
#    R = 29/100 # inches
    function wheel(c, x)
        θs = range(0, 2pi, 100)

        (x .+ R .* cos.(θs), c .+ R .*  sin.(θs))
    end


    y₀ = -2R
    xs = vcat(ts, reverse(ts), first(ts))
    ys = vcat(y₀ .+ zero.(ts), f.(reverse(ts)), y₀)
    poly = tuple.(xs, ys)


    ips(c,x) = sum(inpolygon(pt, poly) for pt in zip(wheel(c,x)...)) - 1/2
    g(x) =  find_zero(c -&gt; ips(c,x), (0,2 +3R))


    as = range(-1.75, 1.25, 251)
    bs = f.(as)
    cs = g.(as)
    plot(as, bs, legend=false, aspect_ratio=:equal)
    for (i, (a,c)) in enumerate(zip(as, cs))
        iszero((i-1) % 3) || continue
        us, vs = wheel(c, a)
        plot!(Plots.Shape(us, vs), fillcolor=:gray, fillalpha=0.001, linewidth=0)
    end
    plot!(as, cs; linecolor=:red)
    current()
end

anim = @animate for r in 0.2:0.1:1.5
    f(r)
end

imgfile = "construction_graphics/trench_size.gif"
gif(anim, imgfile, fps = 5)
nothing</code></pre>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="construction_graphics/trench_size.gif" class="img-fluid figure-img"></p>
<figcaption>Path of wheel with varying radius</figcaption>
</figure>
</div>
<pre class="{julia}"><code>#| echo: false
f(0.75)</code></pre>
<p>The red line shows the axle of the wheel.</p>
<p>While not the strongest illustration, the point to take away is:</p>
<ul>
<li><p>the animation shows what would happen were the trench twice the width of the wheel (bumpy) to half the radius of the wheel (smooth).</p></li>
<li><p>if the trench is too wide for wheel – when the trench is wider in the animations – the wheel will not roll smoothly (leading mountain bikers to act). The wheel is typically around 15 inches in radius, and anything bigger than 12” would be problematic.</p></li>
</ul>
<p>Most of the current fords are much narrower, maybe 6-8 inches across. It is believed 8-12 inches is a better balance between allowing sufficient water flow while providing a good experience for both hiker and biker.</p>
<div id="fig-CCC-fords" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-CCC-fords-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 33.3%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="construction_graphics/CCC-ford-Y-collector.jpg" class="img-fluid figure-img"></p>
<figcaption>CCC era “Y”-collector</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 33.3%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="construction_graphics/ccc-ford-too-narrow.jpg" class="img-fluid figure-img"></p>
<figcaption>CCC era ford</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 33.3%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="construction_graphics/ccc-style-ford.jpg" class="img-fluid figure-img"></p>
<figcaption>CCC era style ford</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-CCC-fords-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.1: Two CCC fords and a new one in the style. On the left is hint of the “Y”-collector design. The stones for the ford could be re-positioned. The middle figure shows a too-narrow part. Though hard to see in the photo, there is much leaf accumulation in the narrow part which inhibits effectiveness of the ford. The right figure illustrates two issues: use of non-natural materials, insufficient size for stepping rock.
</figcaption>
</figure>
</div>
</section>
<section id="fords-1" class="level4">
<h4 class="anchored" data-anchor-id="fords-1">Fords</h4>
<p>A better design is to use a smooth entry and exit for the bicycle rider. The figure below illustrates three possible cross sections. This design allows the same <em>cross sectional area</em> as a trench (important so water can flow during peak times) by varying the width and depth, but is smoother for the user.</p>
<pre class="{julia}"><code>#| echo: false
f(x) = cospi(2x - 1)
g(x) = 1/2 + f(x/2)/2
x = [-1/2, -1/4, -1/4, 1/4, 1/4, 1/2]
y = [1, 1, -1, -1, 1, 1]
plot(f, -1/2, 1/2; legend=false,  axis=([], false))
plot!(x,y)
plot!(g, -1, 1)</code></pre>
<p>The suggested design would be about 2 feet across and 4-5 inches deep.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="construction_graphics/smooth-ford.jpg" class="img-fluid figure-img"></p>
<figcaption>A smooth ford that is both effective and unobtrusive on Turtleback Connector</figcaption>
</figure>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Takeaway
</div>
</div>
<div class="callout-body-container callout-body">
<p>For existing trenches, make sure they are clear and sufficiently wide to not catch leaves.</p>
<p>For new fords, use a smoother design for better trail experience.</p>
<p>Do <strong>not</strong> design new fords so deep that you want to put a rock in the ford to facilitate the step over – this defeats the purpose of the ford. Wider is better than deeper for the user.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="construction_graphics/ford-rock-in-center.jpg" class="img-fluid figure-img"></p>
<figcaption>Example ford dug so deep a rock is placed to step/ride across</figcaption>
</figure>
</div>
<p>For heavily traversed areas, Belgian block reinforced fords have been used.</p>
</div>
</div>
<p>In addition, fords may gather <em>sediment</em> over time, reducing the amount of water that can flow across in a given period of time. This is due to water slowing down at the ford. Slower water can carry less sediment, so when the flow slows, sediment will be dropped.</p>
<p>Water slowing down can happen for several reasons:</p>
<ul>
<li>the downhill angle of the ford is less than the downhill angle of the uphill waterflow</li>
<li>the width of the ford is narrower than the width of the water flowing into the ford.</li>
<li>The ford narrows at a point</li>
<li>the ford has a bend</li>
<li>there is inadequate downhill drainage for the ford</li>
</ul>
<p>All of these should be considered when creating a new ford and minimized as best as possible to reduce the need for future maintenance.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
New ford construction
</div>
</div>
<div class="callout-body-container callout-body">
<p>The suggested new ford construction then would be:</p>
<ul>
<li>Site fords where water is crossing or entering the trail. Often such water is channeled above the trail.</li>
<li>Use “Y” collector design to capture as much surface flow as possible</li>
<li>Ensure sufficient water run off so that water won’t back up into ford or flow back onto trail downhill from the ford</li>
</ul>
<p>“Y” collectors may do <em>two</em> things:</p>
<ul>
<li>collect water running along surface during heavy rains <em>and</em></li>
<li>capture groundwater as it moves downhill after a rain.</li>
</ul>
<p>The former leads to a necessary design of a 4-6 inches of depth, more on steeper sections. The latter is different. Groundwater mostly runs between layers of soil: the organic and the more compacted inorganic. When there is groundwater seepage, The depth of the “Y” collector arms should be at least a few inches deeper than this soil boundary.</p>
<p>The arms of the “Y” collector (drainage swales) should be sufficiently off the trail to not be a tripping hazard for walkers. They should run downhill – not on a contour. They should be a straight as possible. They will likely have vegetation over time or be filled with leaves. When constructing – like all <em>off-trail</em> features – they are ideally covered with leaves to mask their presence.</p>
</div>
</div>
</section>
</section>
<section id="water-bars" class="level3" data-number="3.2.2">
<h3 data-number="3.2.2" class="anchored" data-anchor-id="water-bars"><span class="header-section-number">3.2.2</span> Water bars</h3>
<p>Fords allow channeled water to cross over a trail in a perpendicular manner. A <em>water bar</em> is used to move water that is flowing <em>down</em> the trail off the trail.</p>
<p>Water bars may be constructed of rock or wood, but we use rock harvested on the site to create water bars. This ensure the longest lasting, most natural looking waterbar.</p>
<p>The placement of a waterbar considers</p>
<ul>
<li>a waterbar should capture the waterflow as early as possible</li>
<li>if designed well, they should capture all the water coming down the trail. They need not be spaced close together</li>
</ul>
<p>The design of a waterbar<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a></p>
<ul>
<li>the should be at a 45-60 degree angle to the trail. As the water slows down on hitting a waterbar, there will be more sediment buildup were the water bar at less of an angle</li>
</ul>
<pre class="{julia}"><code>#| echo: false
theta = 60
x=[0,1]
y = [sind(0), sind(60)]
plot(x, y; legend=false, aspect_ratio=:equal)
vline!([0,1], line=(:gray, 0.5))
annotate!([(.1,.05, "θ ~ 45-60 degree", :left)])
quiver!([0.5], [0.2], quiver=([0.0],[0.5]))</code></pre>
<ul>
<li>the waterbar is a vertical feature, like the curbing on the road. It does not include a swale in front of it. Swales will only fill in with sediment over time. (This is not necessarily suggested by the AMC, but experience shows otherwise.)</li>
</ul>
<p>Waterbars are made of rocks. The face of the waterbar should extend up 4 inches. (Like the curbing on a road.) Ideally rocks can be found to allow for shingling so water does not seep through the interface between two rocks.</p>
<p>The AMC describes two styles: the <em>cake</em> style where large flat rocks abut each other giving a place to step on the top of the water bar and a flat face for the water to flow across; the <em>toast</em> style uses shingle like rocks (overlapped) and are generally narrower and not meant for stepping on.</p>
<div id="fig-waterbars" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-waterbars-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-waterbars" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-cake" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-cake-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="construction_graphics/waterbar-cake.jpg" class="img-fluid figure-img" data-ref-parent="fig-waterbars">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-cake-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) Cake
</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-waterbars" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-toast" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-toast-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="construction_graphics/waterbar-toast.jpg" class="img-fluid figure-img" data-ref-parent="fig-waterbars">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-toast-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) Toast
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-waterbars-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.2: Two waterbar construction styles. (AMC)
</figcaption>
</figure>
</div>
<p>Waterbars should have rocks <em>solidly</em> anchored in place. Anchoring a rock requires a few things: first the rock should be sufficiently large so 6-10 inches of rock can be buried below the surface. Next, dig a “grave” for the rock as tight as possible. Then hammer (with a pick or large rock) pointed rocks on the side of the rock to firm up the placement. Back fill with gravel or smaller rock, then use dirt to cover.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Anchored
</div>
</div>
<div class="callout-body-container callout-body">
<p>Any rock on the trail should not rock when stepped on and should definitely not be loose. This requires the use of large rocks. Do not expect rocks to “settle.” They should be solid when the waterbar is constructed.</p>
</div>
</div>
<p>Rocks placed on the side of a water bar force the users to stay on the trail. If not anchored, these should be piled large enough to discourage being stepped on.</p>
<p>For hikers and bikers adding packed dirt to the height of the <em>downhill</em> portion of the waterbar allows both to smoothly move uphill. The height of the waterbar is not so high to make it difficult to cross going downhill (yet still tall enough to capture and divert strong waterflow).</p>
<p>In the middle of the trail, it is helpful to have a rock placed that has a top face encouraging stepping on. (The cake method has all it rocks so.)</p>
</section>
<section id="swales" class="level3" data-number="3.2.3">
<h3 data-number="3.2.3" class="anchored" data-anchor-id="swales"><span class="header-section-number">3.2.3</span> Swales</h3>
<p>The engineered design of the woods roads was done by the CCC and involves swales and culverts. In addition, on the trails the CCC used drainage swales as part of the “Y” drainage features. The design of these drainage swales is less critical. We discuss the design and maintenance of the carriage road swales here.</p>
<p>The basic design employed by the CCC when putting in a carriage road had downhill waterflow channeled into an uphill swale running parallel to the road. Periodically the water is routed under the road using a culvert. After nearly 100 years, this design has mostly held up, but there are areas where maintenance is needed.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="construction_graphics/working-culvert.jpg" class="img-fluid figure-img"></p>
<figcaption>Working swale and culvert on Hillspur carriage road</figcaption>
</figure>
</div>
<p>The peak amount of water a swale sees is related to the surface area of the region draining into the swale and the amount of rain falling. The swale must be large enough in cross-sectional area to accommodate peak water flow, otherwise it will be breached.</p>
<div id="fig-breached" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-breached-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="construction_graphics/hillspur-breach.jpg" class="img-fluid figure-img"></p>
<figcaption>Breach on Hillspur trail</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="construction_graphics/hillspur-erosion.jpg" class="img-fluid figure-img"></p>
<figcaption>Massive erosion on Hillspur trail</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-breached-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.3: Breach on Hillspur trail leading towards massive downhill erosion. The breach is due to: side flow entering trail; a tree that has grown to block swale flow since the 1930s; deposition of leaves due to water slowing
</figcaption>
</figure>
</div>
<p>The swales are often filled with rock called riprap.</p>
<section id="technical-design-of-swales" class="level4">
<h4 class="anchored" data-anchor-id="technical-design-of-swales">Technical design of swales</h4>
<p>The following primarily comes from consulting a <a href="https://opcgis.deq.state.ms.us/Erosion_Stormwater_Manual_2ndEd/Volume1/Chap_4_Sections/4_4/V1_Chap4_4_Runoff_Conveyance_RS.pdf">State of Mississippi</a> document.</p>
<p>Swales are broad shallow ditches used to capture rainwater.</p>
<p>Swales may be filled with grass or riprap, erosion resistant rock used to slow water flow and inhibit soil erosion.</p>
<p>Drainage swales, as described, are used to divert stormwater into designated fords.</p>
<p>The swales along the historic carriage roads are used to manage larger volumes of stormwater uphill of the road until a culvert is used to discharge the water, crossing under the road to the downhill side.</p>
<p>The design of a swale cross section and lining is based primarily upon the volume and velocity of flow expected in the swale. Riprap-lined swales should be used where velocities are in the range of 5 to 10 ft/sec.</p>
<p>In road construction, Riprap-lined swales are trapezoidal in shape. (The steepest permissible side slope of the swale should be 2:1; Horizontal: Vertical.) In South Mountain Reservation, the swales ore “U”-shaped.</p>
<p>We read “outlet conditions for all swales should be considered. This is particularly important for the transition from the riprap lining to a vegetative lining. Appropriate measures must be taken to dissipate the energy of the flow to prevent scour of the receiving swale.” This may not be applicable in the SMR, though there is engineering in the swale as they approach a culvert.</p>
<p>“Lined swales shall be designed to convey the peak rate of runoff from a 10-year 24-hour rainfall event.” We can only assume this calculation was done correctly in the 1930s during the construction.</p>
<p>Design flow depth should accommodate peak water velocity which by the <a href="https://en.wikipedia.org/wiki/Manning_formula">Manning formula</a> is</p>
<p><span class="math display">\[
V = \frac{k}{n}R_h^{2/3}S^{1/2}
\]</span></p>
<p>where:</p>
<ul>
<li><span class="math inline">\(S\)</span> is the bed slope in (feet/feet). Steeper slopes lead to increased velocities in a square root manner</li>
<li><span class="math inline">\(R_h\)</span> is the hydraulic radius of the swale. It is basically the cross-sectional area divided by the perimeter. (Water flows slower along the boundary, so perimiter length inhibits velocity.)</li>
<li><span class="math inline">\(n\)</span> is Manning’s coefficient of roughness (which is modified by the rip-rap; bigger <span class="math inline">\(n\)</span> means slower velocities.)</li>
<li><span class="math inline">\(k\)</span> a conversion factor.</li>
</ul>
<p>The parameters that can be engineered are <span class="math inline">\(n\)</span> (by adding riprap) and <span class="math inline">\(R_h\)</span>.</p>
<p>The latter is manageable. The cross sectional areas of the swale can be impacted by several manageable things:</p>
<ul>
<li>often cut logs are placed in swales</li>
<li>since the 1930s trees may have grown on the edge of swale</li>
<li>pinch points where leaves collect can cause a reduction in cross-sectional area</li>
<li>some rip-rap is too large for the use and reduces the area</li>
</ul>
<p>For the latter, Mississippi gives guidance from the <em>Design of Roch Chutes</em> by Robinson, Rice, and Kadavy:</p>
<p>For slopes between 2 and 10 percent the median diameter is given by <span class="math inline">\((q\cdot \sqrt{S}/4.75 \cdot 10^{-3})^{1.89}\)</span>. In short:</p>
<ul>
<li>Bigger swales have bigger <span class="math inline">\(q\)</span>s, so bigger rocks are permissible.</li>
<li>Bigger slopes allow bigger rocks.</li>
</ul>
<p>Empirically, softball sized stones seem to be appropriate for larger stones</p>
<p>Mississippi says:</p>
<ul>
<li>The layering should be a dense, uniform, and wellgraded mass with few voids. Riprap should consist of a well-graded mixture of stone (size and gradation as shown in design specifications) that is hard, angular, and highly chemical, and weather resistant.</li>
<li>Larger stone should predominate, with sufficient smaller sizes to fill the voids between the stones.</li>
<li>The diameter of the largest stone size should be not greater than 1.5 times the d50 size.</li>
<li>Minimum thickness of riprap liner should be 1.5 times the maximum stone diameter.</li>
</ul>
<p>Mississippi says for maintenance:</p>
<ul>
<li><p>Inspect channels at regular intervals and after storm events. Check for rock stability, sediment accumulation, piping, and scour holes throughout the length of the channel.</p></li>
<li><p>When stones have been displaced, remove any debris and replace the stones in such a way as to not restrict the flow of water.</p></li>
<li><p>Look for erosion at inlets and outlets.</p></li>
<li><p>Give special attention to outlets and points where concentrated flow enters the channel and repair eroded areas promptly by extending the riprap as needed.</p></li>
</ul>
<p>The design of swales in the SMR, and elsewhere, at an outlet (a culvert) is to give a slight uphill wiggle in the otherwise parallel-to-the-road route. This encourages water flow into the culvert by bouncing it on the opposite wall or inducing an eddy.</p>
<p>However, this design also slows water, which causes sediment – and noticeably leaves – to accumulate some 5-10’ uphill of the culvert. Clearing this should also be added to maintenance.</p>
</section>
</section>
<section id="principles" class="level3" data-number="3.2.4">
<h3 data-number="3.2.4" class="anchored" data-anchor-id="principles"><span class="header-section-number">3.2.4</span> Principles</h3>
<blockquote class="blockquote">
<p>Rocks</p>
</blockquote>
<blockquote class="blockquote">
<p>Tread</p>
</blockquote>
<blockquote class="blockquote">
<p>Aesthetic</p>
</blockquote>


</section>
</section>
<section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes">
<hr>
<ol>
<li id="fn1"><p><em>Trail Solutions</em> IMBA’s Guide to Building Sweet Singletrack<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>The <em>AMC’c Complete Guide to Trail Building and Maintenance</em> is consulted here. Waterbars are not favored in the IMBA book, as knicks and other on-trail drainage provides a better biker experience.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
          // target, if specified
          link.setAttribute("target", "_blank");
          if (link.getAttribute("rel") === null) {
            link.setAttribute("rel", "noopener");
          }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./history.html" class="pagination-link" aria-label="History of the trails">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">History of the trails</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./maintenance.html" class="pagination-link" aria-label="Maintenance">
        <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Maintenance</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://somocon.org/edit/main/construction.qmd" class="toc-action"><i class="bi bi-git"></i>Edit this page</a></li><li><a href="https://somocon.org/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div></div></footer><script src="https://cdn.jsdelivr.net/gh/yasserelsaid/chatbot@v0.1.4/index.min.js" data-chatbotid="index-pdf-k527qtaap"></script>




</body></html>